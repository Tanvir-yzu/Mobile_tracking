{% extends 'base.html' %}

{% block content %}
<h2 class="mb-4">My Dashboard</h2>

{% if devices %}
<div class="table-responsive">
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Device Name</th>
        <th>Device ID</th>
        <th>Tracking Active</th>
        <th>Last Updated</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for device in devices %}
      <tr>
        <td>{{ device.name }}</td>
        <td>{{ device.device_id }}</td>
        <td>
          {% if device.is_tracking_active %}
            <span class="badge bg-success">Active</span>
          {% else %}
            <span class="badge bg-secondary">Inactive</span>
          {% endif %}
        </td>
        <td>{{ device.last_updated|date:"M d, Y H:i" }}</td>  <!-- Format timestamp -->
        <td>
          <!-- Pass device ID to live map for specific device tracking -->
          <a href="{% url 'live_map' %}" class="btn btn-sm btn-info">View Map</a>
          <a href="{% url 'device_settings' device.id %}" class="btn btn-sm btn-warning">Edit</a>
          <!-- Add location history link -->
          <a href="{% url 'location_history' device.id %}" class="btn btn-sm btn-primary">History</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% else %}
<p>You have no devices yet. <a href="{% url 'add_device' %}">Add a new device</a>.</p>  <!-- Fixed URL name -->
{% endif %}

<!-- Add button to register new device -->
{% if devices %}
<div class="mt-3">
  <p>You have no devices yet. <a href="{% url 'add_device' %}">Register a device</a>.</p>
</div>
{% endif %}


{% if devices %}
  <div class="mt-3">
    <a href="{% url 'add_location_data' %}" class="btn btn-info">
      âž• Add Location Manually
    </a>
  </div>
{% else %}
  <p>You have no devices yet. <a href="{% url 'add_device' %}">Register a device</a>.</p>
{% endif %}

<style>
  .badge.bg-success { background-color: #28a745; }
  .badge.bg-secondary { background-color: #6c757d; }
  .btn-group .btn { margin-right: 5px; }
</style>
{% endblock %}